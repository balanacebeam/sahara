(function($,undefined){$.ui.tree.edit=function(tree,params){this.tree=tree;this.params=params||{};this._create()};$.ui.tree.edit.prototype={_create:function(){},startup:function(){},add:function(treeNode,children){children=children||[];if(0==children.length){return}var node=treeNode.getNode(),runtimeData=treeNode.getRuntimeData();this.tree.transformtreedata(runtimeData,children);if(this.tree.isLeafByNode(node)){var data=treeNode.getData(),md=this.tree.options.metadata;if(data[md["leaf"]]){data[md["leaf"]]=false}node.removeClass("leaf");node.addClass("collapsed")}else{var subtree=$(">.subtree",node);if(subtree.length){var fragment=document.createDocumentFragment(),paddingLeft=this.tree.getLeftPadding(node)+20,newChildren=runtimeData["c"];for(var i=newChildren.length-children.length,child;child=newChildren[i];i++){var n=this.tree.renderNode(child,paddingLeft)[0];fragment.appendChild(n)}subtree.append(fragment)}}var onAdd=this.params.onAdd;onAdd&&onAdd(treeNode)},update:function(treeNode){var node=treeNode.getNode(),newHeader=$(">.header",this.tree.renderNode(treeNode.getRuntimeData(),this.tree.getLeftPadding(node),true));node.prepend(newHeader);newHeader.next().remove();var onUpdate=this.params.onUpdate;onUpdate&&onUpdate(treeNode)},remove:function(treeNode){var node=treeNode.getNode(),md=this.tree.options.metadata,self=this;if(node.hasClass("root")){return}this.tree.foreach({treeNode:treeNode,each:function(runtimeData){var data=runtimeData["d"],id=data[md["id"]];delete self.tree.runtimedatasbase[id];delete self.tree.nodesbase[id]}});var index=treeNode.getIndex(),parentTreeNode=treeNode.getParent();pRuntimeData=parentTreeNode.getRuntimeData(),pNode=parentTreeNode.getNode();pRuntimeData["c"].splice(index,1);node.remove();if(this.tree.isLeafByData(pRuntimeData)){pNode.removeClass("expanded");pNode.removeClass("collapsed");pNode.addClass("leaf");$(">.subtree",pNode).remove()}var onRemove=this.params.onRemove;onRemove&&onRemove(treeNode)},slideUp:function(treeNode){var prevNode=treeNode.getPrev();if(prevNode!=null){var parentTreeNode=treeNode.getParent(),index=treeNode.getIndex(),children=parentTreeNode.getRuntimeData()["c"],temp=children[index];children[index]=children[index-1];children[index-1]=temp;prevNode.getNode().before(treeNode.getNode());var onSlideUp=this.params.onSlideUp;onSlideUp&&onSlideUp(treeNode)}},slideDown:function(treeNode){var nextNode=treeNode.getNext();if(nextNode!=null){var parentTreeNode=treeNode.getParent(),index=treeNode.getIndex(),children=parentTreeNode.getRuntimeData()["c"],temp=children[index];children[index]=children[index+1];children[index+1]=temp;nextNode.getNode().after(treeNode.getNode());var onSlideDown=this.params.onSlideDown;onSlideDown&&onSlideDown(treeNode)}}};$.ui.tree.plugins.register("edit",$.ui.tree.edit)})(jQuery);