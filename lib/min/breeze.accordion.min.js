(function($,undefined){$.widget("ui.accordion",$.ui.container,{options:{metadata:{id:"id",title:"title",selected:"selected",parameters:"parameters",iconURL:"iconURL",html:"html",node:"node",get:"get",url:"url",pattern:"pattern"},height:"100%",headerHeight:26,noborder:false,dataProvider:[],loadItem:null},render:function(){var element=this.element,fragment=document.createDocumentFragment(),options=this.options,metadata=options.metadata,selectedIndex=0,dataProvider=options.dataProvider,lastIndex=dataProvider.length-1,self=this;element.addClass("breeze-accordion");options.noborder&&element.addClass("accordion-noborder");$.each(dataProvider,function(index,item){var itemElement=$("<div class='accordion-item'></div>"),html=["<div class='accordion-header'>"];html.push(self.getItemIcon(item));html.push("<div class='accordion-collapse'></div>");html.push("<div class='accordion-title'>");html.push(item[metadata.title]);html.push("</div>");html.push("<div style='clear:both;'></div>");html.push("</div>");itemElement.append($(html.join("")).height(options.headerHeight-11)).append($("<div class='accordion-body'></div>"));if(0==index){itemElement.addClass("accordion-item-firstchild")}else{if(index==lastIndex){itemElement.addClass("accordion-item-lastchild")}}fragment.appendChild(itemElement[0]);if(item[metadata.selected]){selectedIndex=index}});element.append(fragment);if(dataProvider.length){$($(">.accordion-item",element).get(selectedIndex)).addClass("collapsed");this.load(selectedIndex)}},getItemIcon:function(item){var iconURL=this.options.metadata.iconURL;if(item[iconURL]){return"<img class='accordion-icon' src='"+item[iconURL]+"'></img>"}return""},load:function(index){var element=$($(">.accordion-item",this.element).get(index));if(element.attr("loaded")){this.resize2();return}element.attr("loaded",true);var metadata=this.options.metadata,index=$(">.accordion-item",this.element).index(element),item=this.options.dataProvider[index],loadItem=this.options.loadItem,self=this;if(!jQuery.isFunction(loadItem)){this.loadContext({context:$(">.accordion-body",element),html:item[metadata.html],node:item[metadata.node],get:item[metadata.get],url:item[metadata.url],pattern:item[metadata.pattern],parameters:item[metadata.parameters],complete:function(){self.resize2()}})}else{loadItem(item,function(node){$(">.accordion-body",element).append(node||document.createTextNode("&nbsp;"))})}},resize:function(){this.resize0();this.resize1();this.resize2()},resize0:function(){var options=this.options;this.collapsedItemHeight=this.element.height()-(options.headerHeight-1)*(options.dataProvider.length-1)-1},resize1:function(){var self=this,top=0;$.each($(">.accordion-item",this.element),function(){var element=$(this);element.css("top",top+"px");if(element.hasClass("collapsed")){element.height(self.collapsedItemHeight+(element.hasClass("accordion-item-lastchild")&&1||0));top+=self.collapsedItemHeight}else{element.height(self.options.headerHeight);top+=self.options.headerHeight-1}})},resize2:function(){$.each(this.getChildren($(">.collapsed",this.element),function(index,child){child.resize()}))},funnelEvents:function(){var self=this;this.element.click(function(e){var element=$(e.target),elems=[];while(element[0]!=self.element[0]){elems.unshift(element);element=element.parent()}element=elems[1];if(element&&element.hasClass("accordion-header")){self.toggle(element.parent())}})},toggle:function(element){if(element.hasClass("collapsed")){var neighbor=element.next();if(neighbor[0]){this.toggle(neighbor)}else{neighbor=element.prev();if(neighbor[0]){this.toggle(neighbor)}}return}var selectedELement=$(">.collapsed",this.element),elements=$(">.accordion-item",this.element),oIndex=elements.index(selectedELement),nIndex=elements.index(element),self=this,step=Math.floor(this.collapsedItemHeight/10),begin,end,asc=1,top,distance=0;selectedELement.removeClass("collapsed");element.addClass("collapsed");if(oIndex>nIndex){begin=nIndex+1;end=oIndex}else{begin=oIndex+1;end=nIndex;asc=-1}top=parseInt($(elements[begin]).css("top"),10);var h=self.collapsedItemHeight-26-(asc!=1?0:(end-begin+1)*26),selectedELementHeight=selectedELement.height();(function(){var func=arguments.callee;distance+=asc*step;if(Math.abs(distance)<h){for(var i=begin;i<=end;i++){$(elements[i]).css("top",(top+distance+25*(i-begin))+"px")}var h1=Math.abs(distance);selectedELement.height(selectedELementHeight-h1);element.height(h1+26);setTimeout(func,10);return}self.resize1();self.load(nIndex)})()},showItem:function(index){this.toggle($(">.accordion-item",this.element)[index])}})})(jQuery);