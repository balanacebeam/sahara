(function($,undefined){$.ui.grid.sortable=function(grid){this.grid=grid;this._create()};$.ui.grid.sortable.prototype={_create:function(){var self=this,grid=this.grid,headersNode=grid.headersNode;this.sortNode=$("<div class='sortable asc'></div>");this.sortingColumn=null;headersNode.bind("click.grid-sortable",function(e){var target=$(e.target);if(null==target.attr("idx")){return}var columnMarkup=grid.getColumnMarkup(target);self.sort(columnMarkup)});grid.subscribe("renderHeader.grid-sortable",this,"renderSortIcon");grid.subscribe("sort.grid-sortable",this,"sort")},sort:function(columnMarkup,asc){var column=columnMarkup.column,element=columnMarkup.element,sortNode=this.sortNode;if(false==column.sortable){return}if(column==this.sortingColumn){if(sortNode.hasClass("asc")){sortNode.removeClass("asc");sortNode.addClass("desc")}else{sortNode.removeClass("desc");sortNode.addClass("asc")}}else{sortNode.parent().removeClass("sort");element.addClass("sort");element.append(sortNode);if(sortNode.hasClass("desc")){sortNode.removeClass("desc");sortNode.addClass("asc")}this.sortingColumn=column}if(null!=asc){if(asc){if(sortNode.hasClass("desc")){sortNode.removeClass("desc");sortNode.addClass("asc")}}else{sortNode.removeClass("asc");sortNode.addClass("desc")}}this.sortData(column,sortNode.hasClass("asc"))},sortData:function(column,asc){var dp=this.grid.runtime["dataProvider"],filedIndex=column.filedIndex;dp.sort(function(o1,o2){if("number"==column.dataType){return(asc?1:-1)*(Number(o1["d"][filedIndex]||0)-Number(o2["d"][filedIndex]||0))}return(asc?1:-1)*String(o1["d"][filedIndex]).localeCompare(String(o2["d"][filedIndex]))});this.grid.resize()},renderSortIcon:function(view){var sortingColumn=this.sortingColumn;if(null==sortingColumn){return}for(var i=0,column;column=view.columns[i];i++){if(column==sortingColumn){var target=$("div[idx="+i+"]",view.headerNode);target.addClass("sort");target.append(this.sortNode);return}}},destroy:function(){var grid=this.grid;headersNode=grid.headersNode;headersNode.unbind("click.grid-sortable");grid.unsubscribe("renderHeader.grid-sortable");grid.unsubscribe("sort.grid-sortable");this.sortNode.remove()}};$.ui.grid.plugins.register("sortable",$.ui.grid.sortable)})(jQuery);