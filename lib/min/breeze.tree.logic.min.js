(function($,undefined){$.ui.tree.logic=function(tree,params){this.tree=tree;this.params=params||{};this._create()};$.ui.tree.logic.prototype={_create:function(){this.tree.element.addClass("logic");this.tree.subscribe("renderNode.logic",this,"renderNode");this.tree.subscribe("xhr-render.logic",this,"xhrRender")},renderNode:function(treeNode){var node=treeNode.getNode(),runtimeData=treeNode.getRuntimeData(),logic=$(">.header>.logic",node);runtimeData["s"]?logic.addClass("checked"):logic.removeClass("checked")},xhrRender:function(treeNode){switch(this.params.type){case"cascade":case"cascade-children":case"cascade-half":if($(">.header>.logic",treeNode.getNode()).hasClass("checked")){this.tree.foreach({treeNode:treeNode,each:function(runtimeData){runtimeData["s"]=true}})}break}},startup:function(){var self=this;this.tree.element.click(function(e){var logicNode=$(e.target);if(logicNode.hasClass("logic")&&!logicNode.hasClass("disabled")){var onBeforeCheck=self.params.onBeforeCheck,node=breeze.parent(logicNode,"node"),treeNode=self.tree.getTreeNode(node);if(onBeforeCheck&&false==onBeforeCheck(treeNode)){return}var checked=logicNode.hasClass("checked")?(logicNode.removeClass("checked")&&false):(logicNode.addClass("checked")&&true);treeNode.getRuntimeData()["s"]=checked;switch(self.params.type){case"cascade":self.doCascadeCheck(treeNode,checked);break;case"cascade-parent":self.doParentCheck(treeNode,checked);break;case"cascade-children":self.doChildrenCheck(treeNode,checked);break;case"cascade-half":self.doHalfCheck(treeNode,checked);break}}})},checkAll:function(whole){var logicNodes=$(".logic",this.tree.element);logicNodes.removeClass("half").addClass("checked");this.tree.foreach({treeNode:this.tree.getRootNode(),whole:whole,each:function(runtimeData){runtimeData["s"]=true}})},disCheckAll:function(){var logicNodes=$(".logic",this.tree.element);logicNodes.removeClass("half").removeClass("checked");this.tree.foreach({treeNode:this.tree.getRootNode(),each:function(runtimeData){runtimeData["s"]=false}})},setChecked:function(ids){ids=jQuery.isArray(ids)?ids:[ids];var datasbase=this.tree.runtimedatasbase;for(var i=0,id;id=ids[i];i++){var runtimeData=datasbase[id];if(runtimeData!=null){runtimeData["s"]=true;var treeNode=this.tree.nodesbase[id];if(treeNode){$(">.header>.logic",treeNode.getNode()).addClass("checked")}}}},getChecked:function(){var checkedArray=[];this.tree.foreach({treeNode:this.tree.getRootNode(),each:function(runtimeData){if(runtimeData["s"]){checkedArray.push(runtimeData["d"])}}});return checkedArray},doCascadeCheck:function(treeNode,checked){this.doParentCheck(treeNode,checked);this.doChildrenCheck(treeNode,checked)},doParentCheck:function(treeNode,checked){if(checked){var nodes=breeze.parents(treeNode.getNode(),"node",this.tree.element);for(var i=0,pn;pn=nodes[i];i++){$(">.header>.logic",pn).addClass("checked");this.tree.getTreeNode(pn).setChecked(true)}}},doChildrenCheck:function(treeNode,checked){var logicNodes=$(".logic",treeNode.getNode().children(".subtree"));checked?logicNodes.addClass("checked"):logicNodes.removeClass("checked");this.tree.foreach({treeNode:treeNode,each:function(runtimeData){runtimeData["s"]=checked}})},doHalfCheck:function(treeNode,checked){var node=treeNode.getNode(),nodes=breeze.parents(node,"node",this.tree.element);for(var i=0,pn;pn=nodes[i];i++){if(checked){$(">.header>.logic",pn).addClass("checked");this.tree.getTreeNode(pn).setChecked(true)}var logicNodes=$(">.subtree>.node>.header>.logic",pn);$(">.header>.logic",pn).removeClass("half");for(var j=0,logicNode;logicNode=logicNodes[j];j++){if(!$(logicNode).hasClass("checked")){$(">.header>.logic",pn).addClass("half");break}}}$(">.header>.logic",node).removeClass("half");var logicNodes=$(".logic",node.children(".subtree"));logicNodes.removeClass("half");checked?logicNodes.addClass("checked"):logicNodes.removeClass("checked");this.tree.foreach({treeNode:treeNode,each:function(runtimeData){runtimeData["s"]=checked}})}};$.ui.tree.plugins.register("logic",$.ui.tree.logic)})(jQuery);